---
typora-copy-images-to: SpringCloudPictures
---

# 什么是服务注册中心

所谓服务注册中心就是在整个的微服务架构中单独提出一个服务，这个服务==不完成系统的任何的业务功能==，仅仅用来完成对整个微服务系统的`服务注册`和`服务发现`，以及对`服务健康状态`的`监控和管理`功能。

![服务注册中心](SpringCloudPictures/服务注册中心.png)

- 可以==存储所有的微服务的信息==，如微服务的名称、IP、端口等；
- 可以在进行服务调用时，通过服务发现，查询可用的微服务列表，及网络地址，进行服务调用。
- 可以对所有的微服务进行==心跳检测==，如发现某实例长时间无法访问，就会从服务注册表移除该实例。

Spring Cloud 支持的多种注册中心 Eureka（Netflix）、Consul（Go）、Zookeeper（Java，没有提供UI管理界面）、以及阿里巴巴推出的 Nacos。这些注册中心在本质上都是用来==管理服务的注册和发现==以及==服务状态的检查==。

# Eureka Server（服务注册中心）

## 创建项目并引入依赖

- 创建 SpringBoot 项目并引入 Eureka Server 依赖：

在`SpringCloudParent`（[创建父项目](微服务介绍.md)）下创建`Modules` :arrow_right: 选择 Maven，不要选择`Create from archetype`，
地址：D:\Learning\SpringCloud\SpringCloudCode\SpringCloudDemo\SpringCloudDemoParent\EurekaServer。

- 在`pom.xml`中引入依赖（`spring-cloud-starter-netflix-eureka-server`）

```xml
<dependencies>
    <!--引入SpringBootWeb-->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!--引入Eureka Server-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-server</artifactId>
    </dependency>
</dependencies>
```

## 编写配置

`application.properties`

```properties
# 执行服务的端口
server.port=8761
# 指定服务名称，唯一标识
spring.application.name=EurekaServer
# 指定服务注册中心的地址 
# http://localhost:8761 在注册中心页面不会显示【自己向自己注册】，但后台仍会报错
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
```

## 入口类

入口类加入注解：`@EnableEurekaServer`：

```java
package com.example;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;

@SpringBootApplication
@EnableEurekaServer
public class EurekaServerApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaServerApplication.class, args);
    }
}
```

## 访问注册中心

[http://localhost:8761](http://localhost:8761)

![服务注册中心页面](SpringCloudPictures/服务注册中心页面.png)

## 后台报错

![控制台报错](SpringCloudPictures/控制台报错.png)

出现上述问题原因：既当 server 又当 client。
	

Eureka 组件包含 Eureka Server 和 Eureka Client。Server 是一个==服务注册中心==，用来接受客户端的注册。Server启动时，会将自己作为一个服务中心启动；与此同时，Client的特性会让当前启动的服务，把自己作为 Eureka 的客户端，进行服务中心的注册，默认是启动时立即注册。==当项目启动时，服务注册中心还没有创建好，所以找不到服务的客户端组件，就直接报错了==。当启动成功服务注册中心创建好了，日后 Client 也能进行注册，就不再报错啦！

如果需要其作为一个纯 Eureka Server，需要==关闭 Eureka 自己注册自己==。

## 关闭 Eureka 自己注册自己

```properties
# 执行服务的端口
server.port=8761
# 指定服务名称，唯一标识
spring.application.name=EurekaServer
# 指定服务注册中心的地址
eureka.client.service-url.defaultZone=http://localhost:8761/eureka

# 不再将自己同时作为客户端进行注册
eureka.client.register-with-eureka=false
# 关闭作为客户端时从Eureka Server获取服务信息。让当前服务仅为服务注册中心
eureka.client.fetch-registry=false
```

# 开发 Eureka Client

Eureka Client 就是日后基于业务差分出来的一个个`微服务`。

## 开发过程

### 创建项目并引入依赖

继承[父项目](微服务介绍.md)：在`SpringCloudParent`下创建`Modules`$$\longrightarrow$$​选择 Maven，不要选择`Create from archetype`，
地址：D:\Learning\SpringCloud\SpringCloudCode\SpringCloudDemo\SpringCloudDemoParent\EurekaClient。

在`pom.xml`中引入依赖（`spring-cloud-starter-netflix-eureka-client`）：

```xml
<dependencies>
    <!--引入SpringBootWeb-->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!--引入Eureka Client-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-netflix-eureka-client</artifactId>
    </dependency>
</dependencies>
```

### 配置文件

`application.properties`

```properties
# 执行服务的端口
server.port=8888
# 指定服务名称，唯一标识
spring.application.name=EurekaClient
# 指定服务注册中心的地址
eureka.client.service-url.defaultZone=http://localhost:8761/eureka
```

### Client 入口类加入注解

入口类加入注解`@EnableEurekaClient`

```java
package com.example;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class EurekaClientApplication {
    public static void main(String[] args) {
        SpringApplication.run(EurekaClientApplication.class, args);
    }
}
```

### 启动测试

启动之前 8761 的服务注册中心，再启动 Eureka Client 服务，查看 Eureka Server 的服务注册情况：

服务注册中心控制台输出：

```markdown
Registered instance EUREKACLIENT/localhost:EurekaClient:8888 with status UP (replication=false)
```

Eureka Client 后台输出：

```markdown
DiscoveryClient_EUREKACLIENT/localhost:EurekaClient:8888 - registration status: 204
```

![Client注册到Server](SpringCloudPictures/Client注册到Server.png)

## 使用 Eureka 编写服务提供者

参考资料：[使用Eureka编写服务提供者 (biancheng.net)](http://c.biancheng.net/view/5323.html)



## 使用 Eureka 编写服务消费者

